(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    104291,       2462]
NotebookOptionsPosition[    102455,       2398]
NotebookOutlinePosition[    102799,       2413]
CellTagsIndexPosition[    102756,       2410]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Preamble", "Chapter",
 CellChangeTimes->{{3.780771541527303*^9, 3.780771547398859*^9}}],

Cell["\<\
This section contains the program\[CloseCurlyQuote]s pseudocode and a few \
definitions that should only need to be executed once (as long as the \
parameters are not changed).\
\>", "Text",
 CellChangeTimes->{{3.780771585873912*^9, 3.780771622034917*^9}}],

Cell[CellGroupData[{

Cell["Pseudocode", "Section",
 CellChangeTimes->{{3.7803292543397837`*^9, 3.780329256110973*^9}, {
  3.7807721136837177`*^9, 3.7807721151272697`*^9}}],

Cell[CellGroupData[{

Cell["\<\
Read in the network data files to construct lists and graph objects to \
represent the transit network.\
\>", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
  3.783535758124218*^9, 3.783535781443455*^9}, {3.7835359365377073`*^9, 
  3.7835359398604474`*^9}}],

Cell["Generate subgraphs corresponding to each transit line.", \
"SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
   3.783535758124218*^9, 3.783535781443455*^9}, {3.7835359365377073`*^9, 
   3.783535966567649*^9}, 3.7836275246467514`*^9}],

Cell["\<\
Loop through each transit line for which we wish to create an express route.\
\>", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
  3.783535758124218*^9, 3.783535799564241*^9}}],

Cell[CellGroupData[{

Cell["\<\
For each such line, take a specified fraction of the highest and lowest \
access stops.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
  3.783535758124218*^9, 3.7835358333945026`*^9}, {3.783535867739159*^9, 
  3.78353589861945*^9}, {3.7836275392231827`*^9, 3.783627539433115*^9}}],

Cell["\<\
Contract the line\[CloseCurlyQuote]s subgraph to contain only the chosen \
subset of stops.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
  3.783535758124218*^9, 3.7835358333945026`*^9}, {3.783535867739159*^9, 
  3.7835359312552557`*^9}, {3.7835364182513866`*^9, 3.783536480627716*^9}, {
  3.783627547286495*^9, 3.7836275807344956`*^9}}],

Cell[CellGroupData[{

Cell["\<\
For each unique pair of stops, find the shortest path between them on the \
original subgraph.\
\>", "SubsubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
  3.783535758124218*^9, 3.7835358333945026`*^9}, {3.783535867739159*^9, 
  3.7835359312552557`*^9}, {3.7835364182513866`*^9, 3.783536503154911*^9}, {
  3.783627582866346*^9, 3.783627599136442*^9}}],

Cell["\<\
If the shortest path passes through another express stop, do nothing.\
\>", "SubsubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
   3.783535758124218*^9, 3.7835358333945026`*^9}, {3.783535867739159*^9, 
   3.7835359312552557`*^9}, {3.7835364182513866`*^9, 3.783536503154911*^9}, 
   3.783627582866346*^9}],

Cell["\<\
Otherwise, add an express arc between that pair of stops. The cost of the \
express arc should be the total path cost, minus the expected stopping time \
for each stop skipped.\
\>", "SubsubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
  3.783535758124218*^9, 3.7835358333945026`*^9}, {3.783535867739159*^9, 
  3.7835359312552557`*^9}, {3.7835364182513866`*^9, 3.7835365308492193`*^9}, {
  3.783536641507002*^9, 3.7835366693360767`*^9}, {3.783627613647443*^9, 
  3.7836276155306015`*^9}}]
}, Open  ]]
}, Open  ]],

Cell["\<\
Insert data for the new express routes into the data sets and export the \
updated versions.\
\>", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}, {3.783275121412613*^9, 3.7832751217724123`*^9}, {
  3.783535758124218*^9, 3.7835358333945026`*^9}, {3.783535867739159*^9, 
  3.7835359312552557`*^9}, {3.7835364182513866`*^9, 3.7835365308492193`*^9}, {
  3.783536641507002*^9, 3.7835367032154236`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Parameters", "Section",
 CellChangeTimes->{{3.7807714143939443`*^9, 3.7807714158685155`*^9}}],

Cell["\<\
The parameters defined below can be changed to generate different types of \
example network. Everything below this point should also be re-executed when \
the parameters are updated.\
\>", "Text",
 CellChangeTimes->{{3.780771419110817*^9, 3.780771456481101*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"expressvehicles", "=", 
    RowBox[{"{", "0", "}"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "list", " ", "of", " ", "vehicle", " ", "types", " ", "for", " ", "which", 
    " ", "to", " ", "generate", " ", "express", " ", "routes"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"expressmin", "=", "18"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "minimum", " ", "number", " ", "of", " ", "stops", " ", "required", " ", 
    "for", " ", "a", " ", "line", " ", "to", " ", "be", " ", "considered", 
    " ", "for", " ", "express", " ", "routes"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"expresslowest", "=", "0.1"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "fraction", " ", "of", " ", "lowest", " ", "line", " ", "stops", " ", "to",
     " ", "include", " ", "in", " ", "the", " ", "express", " ", "route"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"expresshighest", "=", "0.1"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "fraction", " ", "of", " ", "highest", " ", "access", " ", "line", " ", 
    "stops", " ", "to", " ", "include", " ", "in", " ", "the", " ", "express",
     " ", "route"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"stoptime", "=", "0.625"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "average", " ", "time", " ", "spent", " ", "at", " ", "a", " ", "stop", 
    " ", 
    RowBox[{"(", "minutes", ")"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"maxfleet", "=", "10000000000"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"maximum", " ", "vehicles", " ", "per", " ", "line"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"excludeexpress", "=", "True"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "whether", " ", "to", " ", "exclude", " ", "lines", " ", "already", " ", 
    "marked", " ", "as", " ", "express", " ", 
    RowBox[{"(", 
     RowBox[{
     "indicated", " ", "by", " ", "an", " ", "\"\<X\>\"", " ", "at", " ", 
      "the", " ", "beginning", " ", "of", " ", "its", " ", "name"}], ")"}]}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"expressmode", "=", "1"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "selects", " ", "a", " ", "mode", " ", "for", " ", "the", " ", "express", 
    " ", "routes", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"0", ":", " ", 
       RowBox[{
       "all", " ", "unbounded", " ", "and", " ", "able", " ", "to", " ", 
        "accept", " ", "the", " ", "same", " ", "vehicle", " ", "type", " ", 
        "as", " ", "the", " ", "parent", " ", "line"}]}], ",", " ", 
      RowBox[{"1", ":", " ", 
       RowBox[{
       "only", " ", "vehicle", " ", "switching", " ", "between", " ", "the", 
        " ", "parent", " ", "and", " ", "its", " ", "express", " ", "route", 
        " ", "is", " ", "allowed"}]}]}], ")"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7807714685817165`*^9, 3.780771469692157*^9}, {
   3.7807722664852037`*^9, 3.7807723285478315`*^9}, {3.7807723622388773`*^9, 
   3.7807724136701546`*^9}, {3.78084871435122*^9, 3.780848790950302*^9}, 
   3.7808553189388647`*^9, {3.7808554668835506`*^9, 3.78085547840916*^9}, 
   3.7808563896968355`*^9, 3.780856483595828*^9, {3.780856916720811*^9, 
   3.7808569330009212`*^9}, {3.780856989281165*^9, 3.7808570479088755`*^9}, {
   3.780857133645026*^9, 3.780857136792862*^9}, {3.780857191360109*^9, 
   3.7808572266899395`*^9}, {3.7808573219851074`*^9, 3.780857331801365*^9}, {
   3.7808607186237993`*^9, 3.7808608617713127`*^9}, {3.78086801485207*^9, 
   3.780868022792763*^9}, {3.780868625444586*^9, 3.7808686683276653`*^9}, 
   3.7808687167390623`*^9, 3.780868928273485*^9, {3.780868975178445*^9, 
   3.780869029117138*^9}, {3.7808711560911093`*^9, 3.7808711605126915`*^9}, {
   3.780871826919999*^9, 3.78087182838951*^9}, {3.780919353945106*^9, 
   3.780919355858287*^9}, {3.7809194392511005`*^9, 3.7809194602362547`*^9}, {
   3.7809424795783677`*^9, 3.780942531855831*^9}, 3.7809429087480173`*^9, {
   3.780943398100117*^9, 3.7809433982011757`*^9}, 3.780943463525234*^9, {
   3.7809437631608467`*^9, 3.7809437999572124`*^9}, {3.780944128426804*^9, 
   3.780944130208231*^9}, {3.7809548978169203`*^9, 3.780954954102132*^9}, {
   3.7809556529361563`*^9, 3.780955655300378*^9}, {3.7809572060161886`*^9, 
   3.780957286426631*^9}, {3.7809600091985383`*^9, 3.780960031317463*^9}, 
   3.780960062558426*^9, 3.7809603584370627`*^9, {3.7809604349608607`*^9, 
   3.7809604491683054`*^9}, {3.78096055718265*^9, 3.780960585183673*^9}, {
   3.781009447658851*^9, 3.781009450770296*^9}, 3.7810095429309545`*^9, {
   3.7810095953263674`*^9, 3.781009598897485*^9}, {3.7810107937042007`*^9, 
   3.7810107957861757`*^9}, {3.7810115227225223`*^9, 
   3.7810115779611545`*^9}, {3.7810144668674707`*^9, 3.781014555418959*^9}, {
   3.781021911321941*^9, 3.7810219179143763`*^9}, {3.781022006406988*^9, 
   3.781022019979051*^9}, {3.7810220870844736`*^9, 3.7810220920483017`*^9}, {
   3.781022136700799*^9, 3.7810221586987467`*^9}, 3.7810242811723967`*^9, 
   3.781025843944352*^9, {3.781026486109403*^9, 3.7810264895588293`*^9}, 
   3.781026533341668*^9, {3.7810267248091764`*^9, 3.7810267248731766`*^9}, {
   3.7810267823857317`*^9, 3.781026794780738*^9}, {3.7810269293668833`*^9, 
   3.7810269294878497`*^9}, {3.781029403505779*^9, 3.781029425451626*^9}, {
   3.7810300705419583`*^9, 3.781030150675523*^9}, 3.7810303712836375`*^9, 
   3.781215050151699*^9, 3.7812152277791834`*^9, {3.7812152606319723`*^9, 
   3.7812152635091543`*^9}, {3.7812153196418*^9, 3.781215335208852*^9}, {
   3.781215390410019*^9, 3.7812153920804825`*^9}, {3.7812177595629854`*^9, 
   3.7812178587399287`*^9}, 3.7812182499173217`*^9, {3.781221281030157*^9, 
   3.7812212897259045`*^9}, {3.781221335134143*^9, 3.7812213526717744`*^9}, {
   3.781221494043868*^9, 3.7812215004582353`*^9}, {3.7812218463120584`*^9, 
   3.7812218476089535`*^9}, {3.7812220266803837`*^9, 3.7812220725488634`*^9}, 
   3.7812221063527718`*^9, 3.7812223818225613`*^9, 3.7812225156170373`*^9, {
   3.781222683887783*^9, 3.7812226873382235`*^9}, 3.7812228167200346`*^9, {
   3.782320289723398*^9, 3.782320292056741*^9}, 3.7823203428701305`*^9, {
   3.7823204535972333`*^9, 3.7823204571647677`*^9}, 3.782320488175474*^9, {
   3.7832751342874274`*^9, 3.783275190321265*^9}, {3.783529645031732*^9, 
   3.7835297670376325`*^9}, 3.783535592725218*^9, {3.783535636639357*^9, 
   3.7835357449982214`*^9}, {3.7835368635980864`*^9, 3.783536882453181*^9}, {
   3.7836129450385265`*^9, 3.78361294883002*^9}, {3.7836129956051607`*^9, 
   3.783613027849869*^9}, {3.783613070210322*^9, 3.783613087964734*^9}, {
   3.783614429611723*^9, 3.7836144361899085`*^9}, {3.783614470924831*^9, 
   3.7836144864174337`*^9}, {3.783618220045424*^9, 3.7836182716051664`*^9}, {
   3.783623337081148*^9, 3.78362338187745*^9}, 3.7836261094588256`*^9, {
   3.7836261429090824`*^9, 3.7836261448940096`*^9}, 3.783626492392001*^9, {
   3.783626565987776*^9, 3.783626596747453*^9}, {3.784146722253093*^9, 
   3.7841468057251635`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Section",
 CellChangeTimes->{{3.7809609444987016`*^9, 3.780960945520376*^9}}],

Cell["\<\
The following functions should only need to be defined when the above \
parameters are changed.\
\>", "Text",
 CellChangeTimes->{{3.780960947868601*^9, 3.7809609775890903`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Generates", " ", "the", " ", "arc", " ", "set", " ", "for", " ", "a", 
     " ", "graph", " ", "g", " ", "and", " ", "a", " ", "vertex", " ", 
     "subset", " ", 
     RowBox[{"s", ".", " ", "Outputs"}], " ", "a", " ", "list", " ", "of", 
     " ", "arcs", " ", "and", " ", "a", " ", "list", " ", "of", " ", "arc", 
     " ", 
     RowBox[{"costs", ".", "\[IndentingNewLine]", "Arcs"}], " ", "are", " ", 
     "generated", " ", "to", " ", "directly", " ", "connect", " ", "the", " ",
      "vertices", " ", "according", " ", "to", " ", "their", " ", "shortest", 
     " ", "paths", " ", "in", " ", "the", " ", "initial", " ", 
     RowBox[{"network", ".", " ", "Vertex"}], " ", "pairs", " ", "whose", " ",
      "shortest", " ", "path", " ", "includes", " ", "another", " ", 
     "specified", " ", "vertex", " ", "are", " ", "not", " ", "directly", " ", 
     RowBox[{"connected", ".", " ", "The"}], " ", "total", " ", "cost", " ", 
     "of", " ", "the", " ", "new", " ", "arc", " ", "is", " ", "the", " ", 
     "total", " ", "cost", " ", "of", " ", "the", " ", "shortest", " ", 
     "path"}], ",", " ", 
    RowBox[{
    "minus", " ", "the", " ", "expected", " ", "stopping", " ", "time", " ", 
     "at", " ", "each", " ", "skipped", " ", 
     RowBox[{"stop", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"subgrapharcs", "[", 
     RowBox[{"g_", ",", "s_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"a", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"c", "=", 
         RowBox[{"{", "}"}]}], ",", "p", ",", "tot"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "process", " ", "each", " ", "unique", " ", "pair", " ", "of", " ", 
        "vertices"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "\[Equal]", "j"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "\[IndentingNewLine]",
              "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "get", " ", "shortest", " ", "path", " ", "vertex", " ", 
              "list"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"p", "=", 
             RowBox[{"FindShortestPath", "[", 
              RowBox[{"g", ",", 
               RowBox[{"s", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"s", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "skip", " ", "if", " ", "there", " ", "is", " ", "no", " ", 
              "shortest", " ", "path"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "p", "]"}], "<", "2"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "\[IndentingNewLine]",
              "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "skip", " ", "if", " ", "the", " ", "path", " ", "includes", " ",
               "another", " ", "subset", " ", "element"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "[", 
                 RowBox[{"s", ",", 
                  RowBox[{"p", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ";;", 
                    RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}], "]"}], ">", 
               "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "\[IndentingNewLine]",
              "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "sum", " ", "weights", " ", "of", " ", "all", " ", "arcs", " ", 
              "on", " ", "the", " ", "shortest", " ", "path"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"tot", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"PropertyValue", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"g", ",", 
                   RowBox[{
                    RowBox[{"p", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "\[DirectedEdge]", 
                    RowBox[{"p", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
                 "EdgeWeight"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{
                  RowBox[{"Length", "[", "p", "]"}], "-", "1"}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "subtract", " ", "waiting", " ", "time", " ", "for", " ", 
              "every", " ", "skipped", " ", "stop"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"tot", "=", 
             RowBox[{"tot", "-", 
              RowBox[{"stoptime", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Length", "[", "p", "]"}], "-", "2"}], ")"}]}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "take", " ", "stop", " ", "time", " ", "as", " ", "a", " ", 
              "minimum", " ", "in", " ", "case", " ", "the", " ", "total", 
              " ", "has", " ", "gotten", " ", "too", " ", "low"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"tot", "=", 
             RowBox[{"Max", "[", 
              RowBox[{"stoptime", ",", "tot"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "add", " ", "new", " ", "arc", " ", "and", " ", "cost", " ", 
              "to", " ", "list"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"a", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"a", ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"s", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "\[DirectedEdge]", 
                 RowBox[{"s", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], ")"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"c", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"c", ",", "tot"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "s", "]"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "s", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"a", ",", "c"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Returns", " ", "the", " ", "boarding", " ", "node", " ", "ID", " ", 
     "corresponding", " ", "to", " ", "a", " ", "given", " ", "stop", " ", 
     "node", " ", "ID", " ", "and", " ", "line", " ", 
     RowBox[{"ID", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"boardof", "[", 
     RowBox[{"n_", ",", "l_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"out", "=", 
        RowBox[{"-", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"nline", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "l"}], ")"}], "&&", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"stopof", "[", 
               RowBox[{"(", 
                RowBox[{"nid", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}], "\[Equal]", 
              "n"}], ")"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"out", "=", 
             RowBox[{"nid", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Break", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "nid", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "out"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.7836142789166145`*^9, 3.783614328910895*^9}, {
  3.783614514559249*^9, 3.783614667248361*^9}, {3.783614707837178*^9, 
  3.7836148335736027`*^9}, {3.783616435446056*^9, 3.7836165924922194`*^9}, {
  3.7836167437073236`*^9, 3.783616770900372*^9}, {3.7836168339715395`*^9, 
  3.7836169024243927`*^9}, {3.783616949186881*^9, 3.7836169559420047`*^9}, {
  3.7836174983732166`*^9, 3.783617559667285*^9}, {3.7836176213553667`*^9, 
  3.783617659163435*^9}, {3.7836179325315723`*^9, 3.7836180283348436`*^9}, {
  3.783618059645907*^9, 3.7836180718718147`*^9}, {3.7836181111146135`*^9, 
  3.7836181907534084`*^9}, {3.7836182804336023`*^9, 3.783618462642949*^9}}],

Cell[" ", "Text",
 Editable->False,
 Selectable->False,
 CellFrame->{{0, 0}, {0, 0.5}},
 ShowCellBracket->False,
 CellMargins->{{0, 0}, {1, 1}},
 CellElementSpacings->{"CellMinHeight"->1},
 CellFrameMargins->0,
 CellFrameColor->RGBColor[0, 0, 1],
 CellSize->{Inherited, 3}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Execution", "Chapter",
 CellChangeTimes->{{3.780771565651047*^9, 3.780771567477462*^9}}],

Cell["\<\
The contents of the following sections may need to be repeatedly re-executed \
to generate satisfactory example networks. They should always be executed in \
order from top to bottom.\
\>", "Text",
 CellChangeTimes->{{3.7807716306375384`*^9, 3.780771649293496*^9}, {
  3.7808685835746193`*^9, 3.7808686061162567`*^9}}],

Cell[CellGroupData[{

Cell["Initialization", "Section",
 CellChangeTimes->{{3.780771521038786*^9, 3.7807715235126934`*^9}, {
  3.7807720128307896`*^9, 3.7807720163927107`*^9}, {3.7832752158998203`*^9, 
  3.783275216956482*^9}, {3.7835295711900277`*^9, 3.7835295724161053`*^9}, {
  3.7835369659173393`*^9, 3.783536967647513*^9}}],

Cell["\<\
Reads the network data files to assemble graph objects and data structures.\
\>", "Text",
 CellChangeTimes->{{3.7835295798334684`*^9, 3.783529600112133*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Set", " ", "directory"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Read", " ", "node", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "nodedata", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nodedata", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<data//node_data.txt\>\"", ",", "Word"}], "]"}], ",", 
          "5"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ncomment", "=", 
        RowBox[{"nodedata", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nid", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"nodedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nname", "=", 
        RowBox[{"nodedata", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"2", ";;"}], ",", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ntype", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"nodedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nline", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"nodedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nvalue", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"nodedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "5"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nidend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nnameend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntypeend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nlineend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nvalueend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"separate", " ", "non"}], "-", 
         RowBox[{"core", " ", "nodes"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "3"}], "}"}], ",", 
             RowBox[{"ntype", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nidend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"nidend", ",", 
               RowBox[{"nid", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nnameend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"nnameend", ",", 
               RowBox[{"nname", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ntypeend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"ntypeend", ",", 
               RowBox[{"ntype", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlineend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"nlineend", ",", 
               RowBox[{"nline", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nvalueend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"nvalueend", ",", 
               RowBox[{"nvalue", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nid", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"nid", ",", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"nname", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"nname", ",", "i"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ntype", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"ntype", ",", "i"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nline", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"nline", ",", "i"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nvalue", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"nvalue", ",", "i"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "nid", "]"}], ",", "1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Read", " ", "arc", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "arcdata", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"arcdata", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<data//arc_data.txt\>\"", ",", "Word"}], "]"}], ",", 
          "6"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"acomment", "=", 
        RowBox[{"arcdata", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"aid", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"arcdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"atype", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"arcdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"aline", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"arcdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"arc", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"arcdata", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "4"}], "]"}], "]"}], "]"}], "\[DirectedEdge]", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"arcdata", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "5"}], "]"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2", ",", 
            RowBox[{"Length", "[", "arcdata", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"atime", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"arcdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "6"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"aidend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"atypeend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"alineend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"arcend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"atimeend", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"separate", " ", "non"}], "-", 
         RowBox[{"core", " ", "arcs"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"3", ",", "4"}], "}"}], ",", 
             RowBox[{"atype", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"aidend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"aidend", ",", 
               RowBox[{"aid", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"atypeend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"atypeend", ",", 
               RowBox[{"atype", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"alineend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"alineend", ",", 
               RowBox[{"aline", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"arcend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"arcend", ",", 
               RowBox[{"arc", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"atimeend", "=", 
             RowBox[{"Prepend", "[", 
              RowBox[{"atimeend", ",", 
               RowBox[{"atime", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"aid", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"aid", ",", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"atype", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"atype", ",", "i"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"aline", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"aline", ",", "i"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"arc", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"arc", ",", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"atime", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"atime", ",", "i"}], "]"}]}]}]}], "\[IndentingNewLine]",
           "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "aid", "]"}], ",", "1", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Read", " ", "transit", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "linedata", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"linedata", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<data//transit_data.txt\>\"", ",", "Word"}], "]"}], 
          ",", "11"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"lcomment", "=", 
        RowBox[{"linedata", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"lid", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lname", "=", 
        RowBox[{"linedata", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"2", ";;"}], ",", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ltype", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lfleet", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lcircuit", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "5"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lscaling", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "6"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"llb", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "7"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lub", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "8"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lfare", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "9"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lfreq", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "10"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lcap", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"linedata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "11"}], "]"}], "]"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Read", " ", "vehicle", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "vehdata", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vehdata", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<data//vehicle_data.txt\>\"", ",", "Word"}], "]"}], 
          ",", "5"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vcomment", "=", 
        RowBox[{"vehdata", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vid", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"vehdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vname", "=", 
        RowBox[{"vehdata", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"2", ";;"}], ",", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vub", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"vehdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vcap", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"vehdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "4"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vcost", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"vehdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "5"}], "]"}], "]"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Read", " ", "initial", " ", "flows"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "flowdata", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"flowdata", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"\"\<data//initial_flows.txt\>\"", ",", "Word"}], "]"}], 
          ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fcomment", "=", 
        RowBox[{"flowdata", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fid", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"flowdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fflow", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"flowdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"2", ";;"}], ",", "2"}], "]"}], "]"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Read", " ", "initial", " ", "solution", " ", "log"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"logdata", "=", 
     RowBox[{"Partition", "[", 
      RowBox[{
       RowBox[{"ReadList", "[", 
        RowBox[{"\"\<data//initial_solution_log.txt\>\"", ",", "Word"}], 
        "]"}], ",", "8"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Read", " ", "line"}], "-", 
     RowBox[{"level", " ", "stop", " ", "metric", " ", "data"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "metdata", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"metdata", "=", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"ReadList", "[", 
            RowBox[{"\"\<output//line_metrics.txt\>\"", ",", "Word"}], "]"}], 
           ",", "3"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"linemetrics", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"Length", "[", "lid", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"linemetrics", "[", 
           RowBox[{"[", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToExpression", "[", 
               RowBox[{"metdata", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "+", "1"}], 
             ")"}], "]"}], "]"}], "=", 
          RowBox[{"Append", "[", 
           RowBox[{
            RowBox[{"linemetrics", "[", 
             RowBox[{"[", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToExpression", "[", 
                 RowBox[{"metdata", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "+", "1"}], 
               ")"}], "]"}], "]"}], ",", 
            RowBox[{"ToExpression", "[", 
             RowBox[{"metdata", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "metdata", "]"}]}], "}"}]}], "]"}], ";"}]}],
      "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Build", " ", "graph", " ", "objects"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"netgraph", "=", 
     RowBox[{"Graph", "[", 
      RowBox[{"nid", ",", "arc", ",", 
       RowBox[{"EdgeWeight", "\[Rule]", "atime"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"linegraph", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v", ",", "e", ",", "w"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"get", " ", 
          RowBox[{"line", "'"}], "s", " ", "boarding", " ", "nodes", " ", 
          "and", " ", "line", " ", "arcs"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"v", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nline", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "\[Equal]", 
               RowBox[{"lid", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"v", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"v", ",", 
                  RowBox[{"nid", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "nid", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"e", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"w", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"aline", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "\[Equal]", 
                 RowBox[{"lid", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "&&", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"atype", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "\[Equal]", "0"}], ")"}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"e", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"e", ",", 
                  RowBox[{"arc", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"w", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"w", ",", 
                  RowBox[{"atime", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "aid", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"linegraph", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"linegraph", ",", 
             RowBox[{"Graph", "[", 
              RowBox[{"v", ",", "e", ",", 
               RowBox[{"EdgeWeight", "\[Rule]", "w"}]}], "]"}]}], "]"}]}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "lid", "]"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "a", " ", "map", " ", "from", " ", "each", " ", 
     "boarding", " ", "node", " ", "to", " ", "its", " ", "corresponding", 
     " ", "stop", " ", "node"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "nbhd", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"process", " ", "each", " ", "boarding", " ", "node"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ntype", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "1"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "the", " ", "stop", " ", "node", " ", "of", " ", "the", " ", 
              "current", " ", "boarding", " ", "node", " ", "will", " ", "be",
               " ", "its", " ", "only", " ", "out"}], "-", 
             RowBox[{
             "neighbor", " ", "that", " ", "is", " ", "a", " ", "stop", " ", 
              "node"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"nbhd", "=", 
             RowBox[{"AdjacencyList", "[", 
              RowBox[{"netgraph", ",", 
               RowBox[{"nid", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"ntype", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"nbhd", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "+", "1"}], "]"}], "]"}], 
                 "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"stopof", "[", 
                   RowBox[{"(", 
                    RowBox[{"nid", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}], "=", 
                  RowBox[{"nbhd", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Break", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
               "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"Length", "[", "nbhd", "]"}]}], "}"}]}], "]"}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "nid", "]"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.7835302097148952`*^9, 3.7835302329805803`*^9}, {
   3.7835302763974824`*^9, 3.7835306201619473`*^9}, {3.7835306891601353`*^9, 
   3.783530759856991*^9}, {3.78353086894108*^9, 3.7835309418281965`*^9}, {
   3.783530980135295*^9, 3.783531111164279*^9}, {3.783531159648484*^9, 
   3.7835312248793583`*^9}, {3.7835312693348775`*^9, 3.783531311756509*^9}, {
   3.7835314181119223`*^9, 3.783531504282431*^9}, {3.7835315430512056`*^9, 
   3.7835317312619295`*^9}, {3.7835318063456116`*^9, 
   3.7835319966329117`*^9}, {3.783532028946336*^9, 3.783532094889991*^9}, 
   3.78353505798984*^9, 3.783535481064458*^9, {3.78353697424115*^9, 
   3.7835369840705433`*^9}, {3.783537021788336*^9, 3.783537146119293*^9}, {
   3.7835371826569667`*^9, 3.783537379526822*^9}, {3.7835374238930054`*^9, 
   3.783537502163785*^9}, 3.7835375451093574`*^9, {3.783537584041836*^9, 
   3.783537586120045*^9}, {3.783537955915882*^9, 3.7835380167009563`*^9}, 
   3.7835452309531317`*^9, {3.7835453639159784`*^9, 3.7835454270793886`*^9}, {
   3.783545469687043*^9, 3.7835454872783613`*^9}, 3.783545520409135*^9, {
   3.7835460040209756`*^9, 3.783546037449954*^9}, {3.783546109559795*^9, 
   3.7835461144100485`*^9}, {3.7835461826726227`*^9, 
   3.7835462433642497`*^9}, {3.7835462737431498`*^9, 
   3.7835463782888803`*^9}, {3.7835467645329905`*^9, 3.783546801410942*^9}, {
   3.78361338353963*^9, 3.7836133871065407`*^9}, {3.7836141817629232`*^9, 
   3.7836142029933476`*^9}, {3.783818407652625*^9, 3.783818443167124*^9}, {
   3.7838184802846456`*^9, 3.7838185535373764`*^9}, {3.783818610061904*^9, 
   3.783818691551771*^9}, {3.783818739297407*^9, 3.7838187731812162`*^9}, {
   3.783818918681916*^9, 3.7838189716368895`*^9}, {3.783819024715823*^9, 
   3.783819195483249*^9}, {3.7838192413903685`*^9, 3.7838192717038064`*^9}, {
   3.783828554269926*^9, 3.783828563244953*^9}, {3.784146525014529*^9, 
   3.7841466950472946`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Express Route Generation", "Section",
 CellChangeTimes->{{3.7835378405247498`*^9, 3.783537844181069*^9}}],

Cell["\<\
Processes each specified line to select a subset of its highest and lowest \
access stops and define a new line.\
\>", "Text",
 CellChangeTimes->{{3.7835378636599927`*^9, 3.7835379020852213`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Copy", " ", "attribute", " ", "lists", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
      "allows", " ", "this", " ", "loop", " ", "to", " ", "be", " ", "re"}], 
      "-", 
      RowBox[{
      "run", " ", "without", " ", "having", " ", "to", " ", "reload", " ", 
       "data"}]}], ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"nidnew", "=", "nid"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nnamenew", "=", "nname"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ntypenew", "=", "ntype"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nlinenew", "=", "nline"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nvaluenew", "=", "nvalue"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nidendnew", "=", "nidend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nnameendnew", "=", "nnameend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ntypeendnew", "=", "ntypeend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nlineendnew", "=", "nlineend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nvalueendnew", "=", "nvalueend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"aidnew", "=", "aid"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"atypenew", "=", "atype"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"alinenew", "=", "aline"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"arcnew", "=", "arc"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"atimenew", "=", "atime"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"aidendnew", "=", "aidend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"atypeendnew", "=", "atypeend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"alineendnew", "=", "alineend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"arcendnew", "=", "arcend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"atimeendnew", "=", "atimeend"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lidnew", "=", "lid"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lnamenew", "=", "lname"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ltypenew", "=", "ltype"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lfleetnew", "=", "lfleet"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lcircuitnew", "=", "lcircuit"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lscalingnew", "=", "lscaling"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"llbnew", "=", "llb"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lubnew", "=", "lub"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lfarenew", "=", "lfare"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lfreqnew", "=", "lfreq"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lcapnew", "=", "lcap"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vidnew", "=", "vid"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vnamenew", "=", "vname"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vubnew", "=", "vub"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vcapnew", "=", "vcap"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vcostnew", "=", "vcost"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fidnew", "=", "fid"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fflownew", "=", "fflow"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"logdatanew", "=", "logdata"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Main", " ", "route", " ", "generation", " ", "loop"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "v", ",", "vtemp", ",", "nl", ",", "nu", ",", "a", ",", "c", ",", 
        "vnew", ",", "vremap", ",", 
        RowBox[{"lcount", "=", "0"}], ",", 
        RowBox[{"ncount", "=", "0"}], ",", 
        RowBox[{"acount", "=", "0"}], ",", "vt"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "only", " ", "consider", " ", "lines", " ", "with", " ", "the", " ", 
          "right", " ", "vehicle", " ", "type", " ", "and", " ", "with", " ", 
          "enough", " ", "stops"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"expressvehicles", ",", 
               RowBox[{"ltype", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ")"}], "&&", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"VertexList", "[", 
                RowBox[{"linegraph", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], 
              "\[GreaterEqual]", "expressmin"}], ")"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"if", " ", "excluding", " ", "already"}], "-", 
              RowBox[{"express", " ", "routes"}]}], ",", " ", 
             RowBox[{
             "also", " ", "exclude", " ", "routes", " ", "whose", " ", "name",
               " ", "begins", " ", "with", " ", "\"\<X\>\""}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"excludeexpress", "\[Equal]", "True"}], ")"}], "&&", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Characters", "[", 
                   RowBox[{"(", 
                    RowBox[{"lname", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "\"\<X\>\""}], 
                ")"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "\[IndentingNewLine]",
              "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "calculate", " ", "number", " ", "of", " ", "highest", " ", 
              "and", " ", "lowest", " ", "metrics", " ", "to", " ", "take"}], 
             " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"vtemp", "=", 
             RowBox[{"linemetrics", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"nl", "=", 
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Length", "[", "vtemp", "]"}], "*", "expresslowest"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"nu", "=", 
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Length", "[", "vtemp", "]"}], "*", "expresshighest"}],
               "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "take", " ", "the", " ", "highest", " ", "and", " ", "lowest", 
              " ", "subsets"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"v", "=", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"vtemp", "[", 
                RowBox[{"[", 
                 RowBox[{";;", "nl"}], "]"}], "]"}], ",", 
               RowBox[{"vtemp", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"-", "nu"}], ";;"}], "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "map", " ", "stops", " ", "to", " ", "boarding", " ", "arcs"}], 
             " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"v", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"boardof", "[", 
                RowBox[{
                 RowBox[{"v", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], ",", 
                 RowBox[{"lid", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", 
                 RowBox[{"Length", "[", "v", "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "arc", " ", "set", " ", "for", " ", "express", 
              " ", "route"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a", ",", "c"}], "}"}], "=", 
             RowBox[{"subgrapharcs", "[", 
              RowBox[{
               RowBox[{"linegraph", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "v"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "if", " ", "express", " ", "route", " ", "is", " ", "not", " ", 
               "connected"}], ",", " ", 
              RowBox[{"skip", " ", "it"}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"WeaklyConnectedGraphQ", "[", 
                RowBox[{"Graph", "[", "a", "]"}], "]"}], "\[Equal]", 
               "False"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Continue", "[", "]"}], ";"}]}], "\[IndentingNewLine]",
              "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"lcount", "+=", "1"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "map", " ", "the", " ", "boarding", " ", "arcs", " ", "back", 
              " ", "onto", " ", "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"a", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"stopof", "[", 
                 RowBox[{"a", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], 
                "\[DirectedEdge]", 
                RowBox[{"stopof", "[", 
                 RowBox[{"a", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"generate", " ", "new", " ", "line", " ", "objects"}], 
             " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"lidnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lidnew", ",", 
               RowBox[{
                RowBox[{"lidnew", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"lnamenew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lnamenew", ",", 
               RowBox[{"\"\<X\>\"", "<>", 
                RowBox[{"lname", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ltypenew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"ltypenew", ",", 
               RowBox[{"ltype", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"lfleetnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lfleetnew", ",", "0"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"lcircuitnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lcircuitnew", ",", 
               RowBox[{"Total", "[", "c", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"lscalingnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lscalingnew", ",", 
               RowBox[{"lscaling", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"llbnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"llbnew", ",", "0"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"lubnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lubnew", ",", "maxfleet"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"lfarenew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lfarenew", ",", 
               RowBox[{"lfare", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"lfreqnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lfreqnew", ",", "0"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"lcapnew", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"lcapnew", ",", "0"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"update", " ", "solution", " ", "log"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
               RowBox[{"logdatanew", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"logdatanew", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "1"}], "]"}], "]"}], "<>", 
                "\"\<_0\>\""}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "generate", " ", "new", " ", "node", " ", "and", " ", "arc", " ",
               "objects"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"vnew", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Max", "[", "nid", "]"}], "+", "i"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "v", "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"vremap", "=", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{
               RowBox[{"-", "1"}], ",", 
               RowBox[{"Length", "[", "nid", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"vremap", "[", 
                RowBox[{"[", 
                 RowBox[{"(", 
                  RowBox[{"stopof", "[", 
                   RowBox[{"v", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], ")"}], "]"}], 
                "]"}], "=", 
               RowBox[{"vnew", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "v", "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"add", " ", "new", " ", "line", " ", "arcs"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"aidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"aidnew", ",", 
                  RowBox[{
                   RowBox[{"aidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"atypenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"atypenew", ",", "0"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"alinenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"alinenew", ",", 
                  RowBox[{"lidnew", "[", 
                   RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"arcnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"arcnew", ",", 
                  RowBox[{
                   RowBox[{"vremap", "[", 
                    RowBox[{"[", 
                    RowBox[{"(", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}], ")"}], "]"}], 
                    "]"}], "\[DirectedEdge]", 
                   RowBox[{"vremap", "[", 
                    RowBox[{"[", 
                    RowBox[{"(", 
                    RowBox[{"a", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "2"}], "]"}], "]"}], ")"}], "]"}], 
                    "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"atimenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"atimenew", ",", 
                  RowBox[{"c", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"fidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"fidnew", ",", 
                  RowBox[{
                   RowBox[{"fidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"fflownew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"fflownew", ",", "0"}], "]"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"add", " ", "new", " ", "boarding", " ", "arcs"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"aidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"aidnew", ",", 
                  RowBox[{
                   RowBox[{"aidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"atypenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"atypenew", ",", "1"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"alinenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"alinenew", ",", 
                  RowBox[{"lidnew", "[", 
                   RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"arcnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"arcnew", ",", 
                  RowBox[{
                   RowBox[{"stopof", "[", 
                    RowBox[{"(", 
                    RowBox[{"v", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}], "]"}], 
                   "\[DirectedEdge]", 
                   RowBox[{"vnew", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"atimenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"atimenew", ",", "0"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"fidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"fidnew", ",", 
                  RowBox[{
                   RowBox[{"fidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"fflownew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"fflownew", ",", "0"}], "]"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"Length", "[", "v", "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"add", " ", "new", " ", "alighting", " ", "arcs"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"aidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"aidnew", ",", 
                  RowBox[{
                   RowBox[{"aidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"atypenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"atypenew", ",", "2"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"alinenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"alinenew", ",", 
                  RowBox[{"lidnew", "[", 
                   RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"arcnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"arcnew", ",", 
                  RowBox[{
                   RowBox[{"vnew", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "\[DirectedEdge]", 
                   RowBox[{"stopof", "[", 
                    RowBox[{"(", 
                    RowBox[{"v", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}], "]"}]}]}], "]"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"atimenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"atimenew", ",", "0"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"fidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"fidnew", ",", 
                  RowBox[{
                   RowBox[{"fidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"fflownew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"fflownew", ",", "0"}], "]"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"Length", "[", "v", "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"add", " ", "new", " ", "nodes"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"nidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"nidnew", ",", 
                  RowBox[{
                   RowBox[{"nidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"nnamenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"nnamenew", ",", 
                  RowBox[{
                   RowBox[{"nname", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"stopof", "[", 
                    RowBox[{"(", 
                    RowBox[{"v", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}], "]"}], "+", "1"}], 
                    "]"}], "]"}], "<>", "\"\<_Route\>\"", "<>", 
                   RowBox[{"lnamenew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ntypenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"ntypenew", ",", "1"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlinenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"nlinenew", ",", 
                  RowBox[{"lidnew", "[", 
                   RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nvaluenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"nvaluenew", ",", 
                  RowBox[{"-", "1"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"Length", "[", "v", "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ncount", "+=", 
             RowBox[{"Length", "[", "v", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"acount", "+=", 
             RowBox[{
              RowBox[{"Length", "[", "a", "]"}], "+", 
              RowBox[{"2", 
               RowBox[{"Length", "[", "v", "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "if", " ", "we", " ", "are", " ", "only", " ", "allowing", " ", 
               "swaps", " ", "between", " ", "lines", " ", "and", " ", 
               "their", " ", "own", " ", "express", " ", "versions"}], ",", 
              " ", 
              RowBox[{
              "create", " ", "a", " ", "new", " ", "vehicle", " ", "type", 
               " ", "just", " ", "for", " ", "this", " ", "line", " ", 
               "pair"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"expressmode", "\[Equal]", "1"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"vt", "=", 
                RowBox[{"ltype", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "add", " ", "a", " ", "new", " ", "vehicle", " ", "type", " ",
                  "that", " ", "copies", " ", "the", " ", "original"}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"vidnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"vidnew", ",", 
                  RowBox[{
                   RowBox[{"vidnew", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"vnamenew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"vnamenew", ",", 
                  RowBox[{
                   RowBox[{"vname", "[", 
                    RowBox[{"[", 
                    RowBox[{"vt", "+", "1"}], "]"}], "]"}], "<>", 
                   "\"\<_Route\>\"", "<>", 
                   RowBox[{"lname", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"vcapnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"vcapnew", ",", 
                  RowBox[{"vcap", "[", 
                   RowBox[{"[", 
                    RowBox[{"vt", "+", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"vcostnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"vcostnew", ",", 
                  RowBox[{"vcost", "[", 
                   RowBox[{"[", 
                    RowBox[{"vt", "+", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"redo", " ", "vehicle", " ", "bounds"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"vubnew", "[", 
                 RowBox[{"[", 
                  RowBox[{"vt", "+", "1"}], "]"}], "]"}], "-=", 
                RowBox[{"lfleet", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"vubnew", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{"vubnew", ",", 
                  RowBox[{"lfleet", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "apply", " ", "the", " ", "new", " ", "vehicle", " ", "type", 
                 " ", "to", " ", "both", " ", "lines"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ltypenew", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "=", 
                RowBox[{"vidnew", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ltypenew", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], "=", 
                RowBox[{"vidnew", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "lid", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "increment", " ", "end", " ", "arc", " ", "and", " ", "node", " ", 
         "IDs"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"aidendnew", "+=", "acount"}], ";", "\[IndentingNewLine]", 
       RowBox[{"nidendnew", "+=", "ncount"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"remap", " ", "end", " ", "arc", " ", "endpoints"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"arcendnew", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], ">", 
             RowBox[{"Max", "[", "nid", "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"arcendnew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "+=", "ncount"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"arcendnew", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}], ">", 
             RowBox[{"Max", "[", "nid", "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"arcendnew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "+=", "ncount"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "arcendnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Generated \>\"", "<>", 
         RowBox[{"ToString", "[", "lcount", "]"}], "<>", 
         "\"\< express routes.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Added \>\"", "<>", 
         RowBox[{"ToString", "[", "ncount", "]"}], "<>", 
         "\"\< nodes and \>\"", "<>", 
         RowBox[{"ToString", "[", "acount", "]"}], "<>", "\"\< arcs.\>\""}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.783537922240781*^9, 3.783537947812325*^9}, {
   3.783544975752054*^9, 3.7835450324530454`*^9}, {3.783545111479868*^9, 
   3.7835451716321955`*^9}, {3.7835469364009933`*^9, 3.78354697556789*^9}, {
   3.7835472139634123`*^9, 3.7835473873786116`*^9}, {3.7835474189591513`*^9, 
   3.7835475275289755`*^9}, {3.783547594559342*^9, 3.7835476133966646`*^9}, {
   3.7836134464415836`*^9, 3.783613487752593*^9}, {3.7836135247617674`*^9, 
   3.783613578383899*^9}, {3.783613643368929*^9, 3.783613724584064*^9}, {
   3.7836137697812877`*^9, 3.7836137851303687`*^9}, {3.7836138279753017`*^9, 
   3.783613876482482*^9}, {3.7836139523875656`*^9, 3.7836139998597727`*^9}, {
   3.78361403455665*^9, 3.7836140491832156`*^9}, {3.78361864997293*^9, 
   3.783618746342846*^9}, 3.7836187848988714`*^9, {3.7836188254321156`*^9, 
   3.7836188391261883`*^9}, {3.783622065342511*^9, 3.783622190088771*^9}, {
   3.783622226134715*^9, 3.7836222534231606`*^9}, {3.7836222834413896`*^9, 
   3.783622301263733*^9}, 3.7836224378451424`*^9, {3.783622491938816*^9, 
   3.783622558770937*^9}, {3.78362259826762*^9, 3.783622599796178*^9}, {
   3.783622642587701*^9, 3.783622672873537*^9}, {3.783622830553832*^9, 
   3.7836230647866535`*^9}, {3.7836231895486813`*^9, 3.783623329531782*^9}, {
   3.7836233863960714`*^9, 3.783623424467639*^9}, {3.783623520689003*^9, 
   3.7836235327596736`*^9}, {3.783623592175062*^9, 3.783623658592269*^9}, {
   3.7836238060981483`*^9, 3.783623891394845*^9}, {3.7836239414924498`*^9, 
   3.7836241457000103`*^9}, {3.7836241815624514`*^9, 
   3.7836246093354726`*^9}, {3.7836246475211377`*^9, 
   3.7836247666090035`*^9}, {3.783624804433035*^9, 3.783624822625065*^9}, {
   3.783624859873822*^9, 3.7836251499677677`*^9}, 3.783625181013936*^9, {
   3.783625234751666*^9, 3.7836252611396837`*^9}, {3.7836252916487722`*^9, 
   3.783625348011346*^9}, {3.783625390956493*^9, 3.783625458184979*^9}, {
   3.7836255150638547`*^9, 3.7836256022814164`*^9}, {3.7836256436736064`*^9, 
   3.783625646714159*^9}, {3.7836257048017883`*^9, 3.783625754188587*^9}, {
   3.7836258212151375`*^9, 3.783625840051964*^9}, {3.7836260174866533`*^9, 
   3.7836260818446255`*^9}, {3.7836261834133296`*^9, 
   3.7836262588999968`*^9}, {3.7836266172452545`*^9, 
   3.7836266666390996`*^9}, {3.783626697257719*^9, 3.783626724581314*^9}, {
   3.783626799026964*^9, 3.783626816698665*^9}, {3.783819492505072*^9, 
   3.783819527241794*^9}, {3.7838207047924376`*^9, 3.783820721444875*^9}, {
   3.783820804007792*^9, 3.7838208393946486`*^9}, {3.7838209023895493`*^9, 
   3.783820908036572*^9}, {3.7838209625862637`*^9, 3.783821055669753*^9}, {
   3.7838218836942663`*^9, 3.783821959147761*^9}, {3.7838220016652164`*^9, 
   3.783822002601917*^9}, {3.783827906836933*^9, 3.7838279331616144`*^9}, {
   3.783827963794093*^9, 3.783827971266387*^9}, {3.783828055865284*^9, 
   3.783828104482753*^9}, {3.783829409758147*^9, 3.7838294600452003`*^9}, {
   3.7841468915071945`*^9, 3.7841469180451775`*^9}, {3.7841487187849717`*^9, 
   3.7841487497568603`*^9}, {3.7841488413657646`*^9, 
   3.7841488750814505`*^9}, {3.7841489599847755`*^9, 3.784149144063653*^9}, {
   3.784149449572715*^9, 3.7841496394307833`*^9}, {3.784150038354928*^9, 
   3.784150045670879*^9}, {3.784150140844982*^9, 3.7841501660778313`*^9}, {
   3.7841502971247993`*^9, 3.784150302941831*^9}, {3.7841504084815164`*^9, 
   3.784150491012946*^9}, 3.7841506165734806`*^9, {3.784150709015151*^9, 
   3.7841507091788826`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["File Export", "Section",
 CellChangeTimes->{{3.7809626146101227`*^9, 3.7809626162315845`*^9}}],

Cell["Writes updated versions of data files.", "Text",
 CellChangeTimes->{{3.7809626206251726`*^9, 3.7809626535056324`*^9}, {
  3.783275221809955*^9, 3.7832752222068377`*^9}, {3.7835322471225834`*^9, 
  3.783532254693207*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Set", " ", "directory"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "node", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nodedata", "=", 
        RowBox[{"{", "ncomment", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"nodedata", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"nodedata", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"nidnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"nnamenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"ntypenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"nlinenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"nvaluenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "nidnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"nodedata", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"nodedata", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"nidendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"nnameendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"ntypeendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"nlineendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"nvalueendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "nidendnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<output//node_data.txt\>\"", ",", "nodedata", ",", 
         "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "arc", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"arcdata", "=", 
        RowBox[{"{", "acomment", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"arcdata", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"arcdata", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"aidnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"atypenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"alinenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"arcnew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"arcnew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"atimenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "aidnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"arcdata", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"arcdata", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"aidendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"atypeendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"alineendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"arcendnew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"arcendnew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"atimeendnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "aidendnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<output//arc_data.txt\>\"", ",", "arcdata", ",", "\"\<Table\>\"", 
         ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "transit", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"linedata", "=", 
        RowBox[{"{", "lcomment", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"linedata", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"linedata", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"lidnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lnamenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"ltypenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lfleetnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lcircuitnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lscalingnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"llbnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lubnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lfarenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lfreqnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"lcapnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "lidnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<output//transit_data.txt\>\"", ",", "linedata", ",", 
         "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "vehicle", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"vehdata", "=", 
        RowBox[{"{", "vcomment", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vehdata", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"vehdata", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vidnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"vnamenew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"vubnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"vcapnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"vcostnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "vidnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<output//vehicle_data.txt\>\"", ",", "vehdata", ",", 
         "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "initial", " ", "flows"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"flowdata", "=", 
        RowBox[{"{", "fcomment", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"flowdata", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"flowdata", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"fidnew", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"fflownew", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "fidnew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<output//initial_flows.txt\>\"", ",", "flowdata", ",", 
         "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Write", " ", "initial", " ", "solution", " ", "log"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
     "\"\<output//initial_solution_log.txt\>\"", ",", "logdatanew", ",", 
      "\"\<Table\>\"", ",", 
      RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], "]"}], 
    ";"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAmIQnfPA7E6TwRvHVwny90G07o6eJyB6jV4rfzOQviKv
KgGiK3J+K4DoENl5eiB6WsMucxAdFtJiA6KPOT71AdFJB74EgegtyjLRIDpw
+6oEEB1k+iMVRN+b4lwMotdyctaB6KrFD5tA9K7EjFkg2oH/9GIQfcFhym6w
eR7z9oPoc1V3joPoA/KCD0D0IfvzX0F05P27Zi1A+szebU4g+tf+q+4guuOk
XSiI9rKViQbRQU7JcSCapcKrEkRbXA+sAtEerRfrQfQEDZFmEL23TNOmFUiv
q39jC6JL8qVCQHQRL1MciPaSOpACopf5XEkF0bUb52WC6IIjx/NAtDv7k3Vt
IP+pcW0B0ZEiX0w3gOw/J2cHou80G6SLGL5x7Nx3LgdEP7sdcH4DkJ71IfMW
iL4X0jV9I5D+IJEwC0QDAG4uyTQ=
  "]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{757, 833},
WindowMargins->{{261, Automatic}, {Automatic, 67}},
FrontEndVersion->"10.4 for Microsoft Windows (64-bit) (April 11, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 93, 1, 64, "Chapter"],
Cell[676, 25, 266, 5, 49, "Text"],
Cell[CellGroupData[{
Cell[967, 34, 150, 2, 63, "Section"],
Cell[CellGroupData[{
Cell[1142, 40, 455, 8, 47, "ItemNumbered"],
Cell[1600, 50, 429, 6, 24, "SubitemNumbered"],
Cell[2032, 58, 375, 6, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[2432, 68, 487, 8, 24, "SubitemNumbered"],
Cell[2922, 78, 545, 9, 24, "SubitemNumbered"],
Cell[CellGroupData[{
Cell[3492, 91, 549, 9, 24, "SubsubitemNumbered"],
Cell[4044, 102, 505, 8, 24, "SubsubitemNumbered"],
Cell[4552, 112, 686, 11, 41, "SubsubitemNumbered"]
}, Open  ]]
}, Open  ]],
Cell[5265, 127, 545, 9, 30, "ItemNumbered"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[5859, 142, 99, 1, 63, "Section"],
Cell[5961, 145, 273, 5, 49, "Text"],
Cell[6237, 152, 7188, 136, 392, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[13462, 293, 96, 1, 63, "Section"],
Cell[13561, 296, 187, 4, 30, "Text"],
Cell[13751, 302, 9900, 223, 1012, "Input"],
Cell[23654, 527, 273, 9, 5, "Text"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[23976, 542, 94, 1, 64, "Chapter"],
Cell[24073, 545, 328, 6, 49, "Text"],
Cell[CellGroupData[{
Cell[24426, 555, 306, 4, 63, "Section"],
Cell[24735, 561, 167, 3, 30, "Text"],
Cell[24905, 566, 29204, 719, 3172, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[54146, 1290, 111, 1, 63, "Section"],
Cell[54260, 1293, 206, 4, 49, "Text"],
Cell[54469, 1299, 36177, 801, 3372, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[90683, 2105, 100, 1, 63, "Section"],
Cell[90786, 2108, 226, 3, 30, "Text"],
Cell[91015, 2113, 11412, 281, 1292, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

